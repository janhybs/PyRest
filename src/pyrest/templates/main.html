<html>
<head><title>Django District</title></head>
<body>
    <h1>In what cities other than DC have you gone to Python meetups?</h1>


  {% if current_user.is_authenticated() %}
    <form method="post" action="#" id="cityform">
        <label>City</label>
        <input type="text" id="city"></input>
        <input type="submit" value="Submit"></input>
    </form>
    <a href="{{ url_for('user.logout') }}">log out {{ current_user.username }}</a>
  {% else %}
    <a href="{{ url_for('user.login', username='Jan Hybs') }}">log in</a>
  {% endif %}

    <div id="cities-list"></div>

    <script type="text/javascript" 
                src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/0.9.16/socket.io.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function() {
            var url = "http://" + document.domain + ":" + location.port;
            var socket = io.connect(url + "/");
            $("#cityform").submit(function(event) {
                socket.emit('city', {'city': $('#city').val()});
                $('#city').val('');
                return false;
            });
            socket.on('city', function(msg) {
                $("#cities-list").prepend('<li>' + msg.city + '</li>');
                console.log ('city event')
                console.log (msg);
            });
            socket.on('connect', function() {
                console.log ('CONNECTED')
            });
            socket.on('disconnect', function() {
                console.log ('DISCONNECTED')
            });
            socket.on('debug', function(msg) {
                console.log ('debug: ')
                console.log (msg);
            });
            window.socket = socket;
            
        });
    </script>
</body>
</html>